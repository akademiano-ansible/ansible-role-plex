---
- hosts: all
  become: yes
  roles:
    - {role: "{{ lookup('env', 'TRAVIS_REPO_SLUG') | basename }}" } #Gets only the repository name

  post_tasks:
    - name: Test Plex webinterface
      uri:
        url: "http://{{ inventory_hostname }}:32400/web"

#    - name: Test PlexPy webinterface
#      uri:
#        url: "http://{{ inventory_hostname }}:8181/home"

    - name: Test with plexupdate if latest version is installed
      shell: "{{ plexupdate_install_location }}/plexupdate.sh | grep -q 'already installed' && (echo 'Latest Plex installed'; exit 0) || (echo 'Latest Plex not installed'; exit 1)"
      changed_when: false